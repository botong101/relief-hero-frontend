import{q as D}from"./chunk-FKMIZAYU.js";import{g as O}from"./chunk-XMQ3WWIA.js";import{a as S}from"./chunk-3IKG3DOQ.js";import{b as P}from"./chunk-TPXSCQ7K.js";import{Eb as b,Fb as M,Hb as y,Na as p,Pa as c,Qa as u,Sa as a,Ta as n,Ua as _,Xa as g,ab as o,bb as f,ca as h,cb as l,db as x,ib as C,tb as v,ya as r,za as m}from"./chunk-LO2TXSAH.js";function I(i,s){if(i&1&&(a(0,"div",7),o(1),n()),i&2){let t=g();r(),l(" ",t.error," ")}}function w(i,s){i&1&&_(0,"div",8)}function E(i,s){i&1&&(a(0,"div",9)(1,"h3"),o(2,"No donations yet"),n(),a(3,"p"),o(4,"Donation records will appear here when donators scan QR codes."),n()())}function k(i,s){i&1&&(a(0,"span",27),o(1,"Your Donation"),n())}function L(i,s){if(i&1&&(a(0,"div",12)(1,"div",13)(2,"div",14)(3,"h3"),o(4),n(),a(5,"span",15),o(6),n(),p(7,k,2,0,"span",16),n(),a(8,"div",17),o(9),n()(),a(10,"div",18)(11,"div",19)(12,"h4"),o(13,"\u{1F464} Affected User"),n(),a(14,"div",20)(15,"p")(16,"strong"),o(17,"Name:"),n(),o(18),n(),a(19,"p")(20,"strong"),o(21,"Phone:"),n(),o(22),n()()(),a(23,"div",21)(24,"h4"),o(25,"\u{1F4E6} Supplies Provided"),n(),a(26,"p",22),o(27),n()(),a(28,"div",23)(29,"h4"),o(30,"\u{1F4CD} Location"),n(),a(31,"p",24),o(32),n()(),a(33,"div",25)(34,"span",26),o(35),n()()()()),i&2){let t=s.$implicit,e=g(2);u("my-donation",e.isMyDonation(t)),r(4),f(t.donator_name),r(2),f(t.donator_email),r(),c("ngIf",e.isMyDonation(t)),r(2),l(" ",e.formatDate(t.donated_at)," "),r(9),x(" ",t.affected_first_name," ",t.affected_last_name,""),r(4),l(" ",t.affected_phone,""),r(5),f(e.getSupplyNeedsSummary(t.supply_needs_fulfilled)),r(5),x("Lat: ",t.latitude,", Lng: ",t.longitude,""),r(3),l("QR: ",t.qr_code,"")}}function z(i,s){if(i&1&&(a(0,"div",10),p(1,L,36,13,"div",11),n()),i&2){let t=g();r(),c("ngForOf",t.donations)("ngForTrackBy",t.trackByDonationId)}}var B=(()=>{class i{constructor(t,e,d){this.donationService=t,this.authService=e,this.cdr=d,this.donations=[],this.loading=!0,this.error="",this.isDonator=!1,this.currentUserId=null}ngOnInit(){let t=this.authService.getCurrentUserValue();this.isDonator=t?.role==="donator",this.currentUserId=t?.id||null,this.loadDonations()}loadDonations(){this.loading=!0,this.error="",console.log("Loading donation history..."),console.log("API URL:",`${this.donationService.apiUrl}/donation-history/`),this.donationService.getDonationHistory().subscribe({next:t=>{console.log("Donation history response:",t),this.donations=t.results||t,this.loading=!1,this.cdr.markForCheck(),console.log("Loaded donations:",this.donations)},error:t=>{this.error="Failed to load donation history",this.loading=!1,this.cdr.markForCheck(),console.error("Error loading donation history:",t)}})}getSupplyNeedsSummary(t){if(!t||Object.keys(t).length===0)return"No supplies recorded";let e=[];return t.people_count&&e.push(`${t.people_count} people`),t.water&&e.push(`${t.water} water`),t.food&&e.push(`${t.food} food`),t.medical_supplies&&e.push(`${t.medical_supplies} medical`),t.clothing&&e.push(`${t.clothing} clothing`),t.shelter_materials&&e.push(`${t.shelter_materials} shelter`),t.other&&e.push(t.other),e.length>0?e.join(", "):"No supplies recorded"}formatDate(t){return new Date(t).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}isMyDonation(t){return this.currentUserId===t.donator}trackByDonationId(t,e){return e.id}static{this.\u0275fac=function(e){return new(e||i)(m(S),m(P),m(v))}}static{this.\u0275cmp=h({type:i,selectors:[["app-donation-list"]],standalone:!0,features:[C],decls:10,vars:4,consts:[[1,"container"],[1,"page-header"],[1,"subtitle"],["class","alert alert-error",4,"ngIf"],["class","spinner",4,"ngIf"],["class","empty-state card",4,"ngIf"],["class","donations-list",4,"ngIf"],[1,"alert","alert-error"],[1,"spinner"],[1,"empty-state","card"],[1,"donations-list"],["class","donation-card card",3,"my-donation",4,"ngFor","ngForOf","ngForTrackBy"],[1,"donation-card","card"],[1,"donation-header"],[1,"donator-info"],[1,"donator-email"],["class","my-badge",4,"ngIf"],[1,"donation-date"],[1,"donation-body"],[1,"affected-user-section"],[1,"affected-details"],[1,"supply-needs-section"],[1,"supply-summary"],[1,"location-section"],[1,"coordinates"],[1,"qr-section"],[1,"qr-code-badge"],[1,"my-badge"]],template:function(e,d){e&1&&(a(0,"div",0)(1,"div",1)(2,"h1"),o(3,"Donation History"),n(),a(4,"p",2),o(5,"QR-based donations made to affected users"),n()(),p(6,I,2,1,"div",3)(7,w,1,0,"div",4)(8,E,5,0,"div",5)(9,z,2,2,"div",6),n()),e&2&&(r(6),c("ngIf",d.error),r(),c("ngIf",d.loading),r(),c("ngIf",!d.loading&&d.donations.length===0),r(),c("ngIf",!d.loading&&d.donations.length>0))},dependencies:[y,b,M,O,D],styles:[".container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:20px}.page-header[_ngcontent-%COMP%]{margin-bottom:30px;text-align:center}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2rem;color:#111827;margin-bottom:10px}.subtitle[_ngcontent-%COMP%]{color:#6b7280;font-size:1rem}.alert[_ngcontent-%COMP%]{padding:15px;border-radius:8px;margin-bottom:20px}.alert-error[_ngcontent-%COMP%]{background-color:#fee;color:#c00;border:1px solid #fcc}.spinner[_ngcontent-%COMP%]{width:50px;height:50px;margin:50px auto;border:4px solid #f3f3f3;border-top:4px solid #3b82f6;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:60px 20px}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.5rem;color:#374151;margin-bottom:10px}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#6b7280}.donations-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}.donation-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:24px;box-shadow:0 2px 8px #0000001a;transition:all .3s ease}.donation-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 16px #00000026}.donation-card.my-donation[_ngcontent-%COMP%]{border:2px solid #3b82f6;background:linear-gradient(to right,#eff6ff,#fff)}.donation-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:20px;padding-bottom:16px;border-bottom:2px solid #e5e7eb}.donator-info[_ngcontent-%COMP%]{flex:1}.donator-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.25rem;color:#111827;margin:0 0 5px;font-weight:600}.donator-email[_ngcontent-%COMP%]{font-size:.875rem;color:#6b7280;display:block;margin-bottom:8px}.my-badge[_ngcontent-%COMP%]{display:inline-block;background:#3b82f6;color:#fff;padding:4px 12px;border-radius:12px;font-size:.75rem;font-weight:600;text-transform:uppercase}.donation-date[_ngcontent-%COMP%]{font-size:.875rem;color:#6b7280;white-space:nowrap;text-align:right}.donation-body[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:20px}.donation-body[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{min-width:0}.donation-body[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:#374151;margin-bottom:8px;text-transform:uppercase;letter-spacing:.5px}.affected-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px 0;font-size:.875rem;color:#111827}.affected-details[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#6b7280;font-weight:500}.supply-summary[_ngcontent-%COMP%]{font-size:.875rem;color:#111827;line-height:1.6}.coordinates[_ngcontent-%COMP%]{font-size:.875rem;color:#111827;font-family:Courier New,monospace}.qr-section[_ngcontent-%COMP%]{grid-column:span 2;margin-top:10px;text-align:center}.qr-code-badge[_ngcontent-%COMP%]{display:inline-block;background:#f3f4f6;color:#374151;padding:6px 16px;border-radius:6px;font-size:.75rem;font-family:Courier New,monospace;font-weight:600;border:1px solid #d1d5db}.card[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 1px 3px #0000001a}@media (max-width: 768px){.donation-header[_ngcontent-%COMP%]{flex-direction:column;gap:10px}.donation-date[_ngcontent-%COMP%]{text-align:left}.donation-body[_ngcontent-%COMP%]{grid-template-columns:1fr}.qr-section[_ngcontent-%COMP%]{grid-column:span 1}}"],changeDetection:0})}}return i})();export{B as DonationListComponent};

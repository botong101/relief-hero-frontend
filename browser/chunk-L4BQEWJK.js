import{C as E,Fa as y,G as T,N as g,U as w,Z as u,a as l,f as p,l as m,m as O,n as I,ra as k,s as R,ta as f}from"./chunk-LO2TXSAH.js";var d=class{constructor(){}loadScript(D,t,i,e=null){if(typeof document<"u"&&!document.getElementById(D)){let s=document.createElement("script");s.async=!0,s.src=t,s.onload=i,e||(e=document.head),e.appendChild(s)}}},h=class{},v={oneTapEnabled:!0},_=(()=>{class o extends d{static{this.PROVIDER_ID="GOOGLE"}constructor(t,i){super(),this.clientId=t,this.initOptions=i,this.changeUser=new f,this._socialUser=new m(null),this._accessToken=new m(null),this._receivedAccessToken=new f,this.initOptions=l(l({},v),this.initOptions),this._socialUser.pipe(g(1)).subscribe(this.changeUser),this._accessToken.pipe(g(1)).subscribe(this._receivedAccessToken)}initialize(t){return new Promise((i,e)=>{try{this.loadScript(o.PROVIDER_ID,"https://accounts.google.com/gsi/client",()=>{if(google.accounts.id.initialize({client_id:this.clientId,auto_select:t,callback:({credential:s})=>{let n=this.createSocialUser(s);this._socialUser.next(n)},prompt_parent_id:this.initOptions?.prompt_parent_id,itp_support:this.initOptions.oneTapEnabled}),this.initOptions.oneTapEnabled&&this._socialUser.pipe(E(s=>s===null)).subscribe(()=>google.accounts.id.prompt(console.debug)),this.initOptions.scopes){let s=this.initOptions.scopes instanceof Array?this.initOptions.scopes.filter(n=>n).join(" "):this.initOptions.scopes;this._tokenClient=google.accounts.oauth2.initTokenClient({client_id:this.clientId,scope:s,prompt:this.initOptions.prompt,callback:n=>{n.error?this._accessToken.error({code:n.error,description:n.error_description,uri:n.error_uri}):this._accessToken.next(n.access_token)}})}i()})}catch(s){e(s)}})}getLoginStatus(){return new Promise((t,i)=>{this._socialUser.value?t(this._socialUser.value):i(`No user is currently logged in with ${o.PROVIDER_ID}`)})}refreshToken(){return new Promise((t,i)=>{google.accounts.id.revoke(this._socialUser.value.id,e=>{e.error?i(e.error):t(this._socialUser.value)})})}getAccessToken(){return new Promise((t,i)=>{this._tokenClient?(this._tokenClient.requestAccessToken({hint:this._socialUser.value?.email}),this._receivedAccessToken.pipe(T(1)).subscribe(t)):this._socialUser.value?i("No token client was instantiated, you should specify some scopes."):i("You should be logged-in first.")})}revokeAccessToken(){return new Promise((t,i)=>{this._tokenClient?this._accessToken.value?google.accounts.oauth2.revoke(this._accessToken.value,()=>{this._accessToken.next(null),t()}):i("No access token to revoke"):i("No token client was instantiated, you should specify some scopes.")})}signIn(){return Promise.reject('You should not call this method directly for Google, use "<asl-google-signin-button>" wrapper or generate the button yourself with "google.accounts.id.renderButton()" (https://developers.google.com/identity/gsi/web/guides/display-button#javascript)')}signOut(){return p(this,null,function*(){google.accounts.id.disableAutoSelect(),this._socialUser.next(null)})}createSocialUser(t){let i=new h;i.idToken=t;let e=this.decodeJwt(t);return i.id=e.sub,i.name=e.name,i.email=e.email,i.photoUrl=e.picture,i.firstName=e.given_name,i.lastName=e.family_name,i}decodeJwt(t){let e=t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),s=decodeURIComponent(window.atob(e).split("").map(function(n){return"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(s)}}return o})(),q=(()=>{class o{static{this.ERR_LOGIN_PROVIDER_NOT_FOUND="Login provider not found"}static{this.ERR_NOT_LOGGED_IN="Not logged in"}static{this.ERR_NOT_INITIALIZED="Login providers not ready yet. Are there errors on your console?"}static{this.ERR_NOT_SUPPORTED_FOR_REFRESH_TOKEN="Chosen login provider is not supported for refreshing a token"}static{this.ERR_NOT_SUPPORTED_FOR_ACCESS_TOKEN="Chosen login provider is not supported for getting an access token"}get authState(){return this._authState.asObservable()}get initState(){return this._initState.asObservable()}constructor(t,i,e){this._ngZone=i,this._injector=e,this.providers=new Map,this.autoLogin=!1,this._user=null,this._authState=new O(1),this.initialized=!1,this._initState=new I,t instanceof Promise?t.then(s=>{this.initialize(s)}):this.initialize(t)}initialize(t){this.autoLogin=t.autoLogin!==void 0?t.autoLogin:!1;let{onError:i=console.error}=t;t.providers.forEach(e=>{this.providers.set(e.id,"prototype"in e.provider?this._injector.get(e.provider):e.provider)}),Promise.all(Array.from(this.providers.values()).map(e=>e.initialize(this.autoLogin))).then(()=>{if(this.autoLogin){let e=[],s=!1;this.providers.forEach((n,r)=>{let c=n.getLoginStatus();e.push(c),c.then(a=>{this.setUser(a,r),s=!0}).catch(console.debug)}),Promise.all(e).catch(()=>{s||(this._user=null,this._authState.next(null))})}this.providers.forEach((e,s)=>{R(e.changeUser)&&e.changeUser.subscribe(n=>{this._ngZone.run(()=>{this.setUser(n,s)})})})}).catch(e=>{i(e)}).finally(()=>{this.initialized=!0,this._initState.next(this.initialized),this._initState.complete()})}getAccessToken(t){return p(this,null,function*(){let i=this.providers.get(t);if(this.initialized)if(i){if(!(i instanceof _))throw o.ERR_NOT_SUPPORTED_FOR_ACCESS_TOKEN}else throw o.ERR_LOGIN_PROVIDER_NOT_FOUND;else throw o.ERR_NOT_INITIALIZED;return yield i.getAccessToken()})}refreshAuthToken(t){return new Promise((i,e)=>{if(!this.initialized)e(o.ERR_NOT_INITIALIZED);else{let s=this.providers.get(t);s?typeof s.refreshToken!="function"?e(o.ERR_NOT_SUPPORTED_FOR_REFRESH_TOKEN):s.refreshToken().then(n=>{this.setUser(n,t),i()}).catch(n=>{e(n)}):e(o.ERR_LOGIN_PROVIDER_NOT_FOUND)}})}refreshAccessToken(t){return new Promise((i,e)=>{if(!this.initialized)e(o.ERR_NOT_INITIALIZED);else if(t!==_.PROVIDER_ID)e(o.ERR_NOT_SUPPORTED_FOR_REFRESH_TOKEN);else{let s=this.providers.get(t);s instanceof _?s.revokeAccessToken().then(i).catch(e):e(o.ERR_LOGIN_PROVIDER_NOT_FOUND)}})}signIn(t,i){return new Promise((e,s)=>{if(!this.initialized)s(o.ERR_NOT_INITIALIZED);else{let n=this.providers.get(t);n?n.signIn(i).then(r=>{this.setUser(r,t),e(r)}).catch(r=>{s(r)}):s(o.ERR_LOGIN_PROVIDER_NOT_FOUND)}})}signOut(t=!1){return new Promise((i,e)=>{if(!this.initialized)e(o.ERR_NOT_INITIALIZED);else if(!this._user)e(o.ERR_NOT_LOGGED_IN);else{let s=this._user.provider,n=this.providers.get(s);n?n.signOut(t).then(()=>{i(),this.setUser(null)}).catch(r=>{e(r)}):e(o.ERR_LOGIN_PROVIDER_NOT_FOUND)}})}setUser(t,i){t&&i&&(t.provider=i),this._user=t,this._authState.next(t)}static{this.\u0275fac=function(i){return new(i||o)(u("SocialAuthServiceConfig"),u(y),u(k))}}static{this.\u0275prov=w({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var $=(()=>{class o extends d{static{this.PROVIDER_ID="FACEBOOK"}constructor(t,i={}){super(),this.clientId=t,this.requestOptions={scope:"email,public_profile",locale:"en_US",fields:"name,email,picture,first_name,last_name",version:"v10.0"},this.requestOptions=l(l({},this.requestOptions),i)}initialize(){return new Promise((t,i)=>{try{this.loadScript(o.PROVIDER_ID,`//connect.facebook.net/${this.requestOptions.locale}/sdk.js`,()=>{FB.init({appId:this.clientId,autoLogAppEvents:!0,cookie:!0,xfbml:!0,version:this.requestOptions.version}),t()})}catch(e){i(e)}})}getLoginStatus(){return new Promise((t,i)=>{FB.getLoginStatus(e=>{if(e.status==="connected"){let s=e.authResponse;FB.api(`/me?fields=${this.requestOptions.fields}`,n=>{let r=new h;r.id=n.id,r.name=n.name,r.email=n.email,r.photoUrl="https://graph.facebook.com/"+n.id+"/picture?type=normal&access_token="+s.accessToken,r.firstName=n.first_name,r.lastName=n.last_name,r.authToken=s.accessToken,r.response=n,t(r)})}else i(`No user is currently logged in with ${o.PROVIDER_ID}`)})})}signIn(t){let i=l(l({},this.requestOptions),t);return new Promise((e,s)=>{FB.login(n=>{if(n.authResponse){let r=n.authResponse;FB.api(`/me?fields=${i.fields}`,c=>{let a=new h;a.id=c.id,a.name=c.name,a.email=c.email,a.photoUrl="https://graph.facebook.com/"+c.id+"/picture?type=normal",a.firstName=c.first_name,a.lastName=c.last_name,a.authToken=r.accessToken,a.response=c,e(a)})}else s("User cancelled login or did not fully authorize.")},i)})}signOut(){return new Promise((t,i)=>{FB.logout(e=>{t()})})}}return o})();export{_ as a,q as b,$ as c};

<div class="scanner-container">
  <div class="scanner-header">
    <h3><span [innerHTML]="getIcon('qr-code') | safeHtml"></span> Scan QR Code</h3>
    <button class="close-button" (click)="closeScanner()">×</button>
  </div>

  <div class="scanner-body">
    <div class="alert alert-error" *ngIf="scanError">
      {{ scanError }}
      <div class="scanner-error-actions">
        <button class="btn btn-primary" (click)="startScanner()">Retry Camera</button>
        <button class="btn btn-secondary" (click)="openInExternalBrowser()">Open in Browser</button>
        <button class="btn btn-secondary" (click)="copyPageLink()">Copy Link</button>
      </div>
    </div>

    <div class="scanner-instructions">
      <p><strong>Instructions:</strong></p>
      <ul>
        <li>Point your camera at the affected user's QR code</li>
        <li>Hold steady until the code is recognized</li>
        <li>The scan will complete automatically</li>
      </ul>
    </div>

    <!-- QR Scanner View -->
    <div id="qr-reader" *ngIf="!showManualEntry"></div>

    <!-- Manual Entry Option -->
    <div class="manual-entry-section">
      <button 
        class="btn btn-secondary" 
        (click)="toggleManualEntry()"
        *ngIf="!showManualEntry">
        <span [innerHTML]="getIcon('keyboard') | safeHtml"></span> Enter Code Manually
      </button>

      <div class="manual-entry-form" *ngIf="showManualEntry">
        <h4>Enter QR Code</h4>
        <p class="help-text">If scanning doesn't work, ask the affected user for their QR code and enter it here:</p>
        <input 
          type="text" 
          [(ngModel)]="manualCode" 
          placeholder="LOC-XXXXXXXXXXXX"
          class="form-control"
        />
        <div class="manual-entry-actions">
          <button 
            class="btn btn-primary" 
            (click)="submitManualCode()"
            [disabled]="!manualCode.trim()">
            ✓ Submit Code
          </button>
          <button 
            class="btn btn-secondary" 
            (click)="toggleManualEntry()">
            ← Back to Scanner
          </button>
        </div>
        <div class="external-help" *ngIf="scanError">
          <p>If your browser blocks the camera, try opening this page in the system browser (Safari/Chrome) or paste the copied link into a new tab.</p>
        </div>
      </div>
    </div>
  </div>
</div>
